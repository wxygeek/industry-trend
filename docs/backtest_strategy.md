# Weinstein 行业轮动策略 — 回测说明

## 策略概述

本策略基于温斯坦（Weinstein）34周均线阶段分析法，利用状态机产生的**确认突破**和**确认崩盘**信号，在申万行业之间进行轮动配置。支持一级行业（31个）和二级行业（124个）。

核心思路：跟踪行业趋势变化，买入进入牛市阶段的行业，卖出进入熊市阶段的行业。

## 信号定义

### 确认突破（breakout_confirmed）— 买入信号

当行业从 **Stage 2（熊牛转换）** 进入 **Stage 3（牛市）** 时触发。

触发条件（满足任一路径）：
- **路径A（标准突破）**：价格偏离度 > alpha 且 MA斜率 > slope_flat 且 成交量比 >= 1.5
- **路径B（持续突破）**：连续站稳MA34达8周 且 价格偏离度 > alpha 且 支撑守住
- **路径C（宽松突破）**：牛市评分 > 底部评分×1.5 且 价格偏离度 > alpha 且 MA斜率 > slope_flat 且 成交量比 >= 1.2

### 确认崩盘（breakdown_confirmed）— 卖出信号

当行业从 **Stage 4（牛熊转换）** 进入 **Stage 1（熊市）** 时触发。

触发条件（满足任一路径）：
- **路径A（标准崩盘）**：价格偏离度 < -alpha 且 MA斜率 < -slope_flat
- **路径B（宽松崩盘）**：熊市评分 > 顶部评分×1.3 且 价格偏离度 < -alpha
- **硬性规则**：连续4周跌破MA34 且 斜率下行 → 强制进入Stage 1

## 仓位管理规则

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 初始资金 | 10,000 | 回测起始资金 |
| 最大持仓数 | 5 | 同时持有行业的上限 |
| 单次买入比例 | 20% | 每次买入金额 = 当前总资产 × 20% |

### 买入逻辑

1. 当某行业出现**确认突破**信号且未持仓 → 买入
2. 买入金额 = 当前总资产（现金 + 持仓市值）× 20%
3. 若现金不足，则买入金额 = 可用现金
4. 同一周有多个买入信号时，逐个执行，每次重新计算总资产

### 卖出逻辑

1. 当持仓行业出现**确认崩盘**信号 → 全部卖出该行业持仓

### 满仓替换逻辑

当已持仓5个行业，且出现新的确认突破信号时：

1. 将所有候选（5个现有持仓 + 新信号行业）按**持仓收益率**排序
2. 持仓收益率 = (当前价格 - 买入价格) / 买入价格
3. 新候选的收益率视为 0%（刚进入）
4. 保留收益率最高的5个，卖出最弱的
5. 如果最弱的是新候选本身，则不执行交易

### 执行顺序

每周处理顺序：**先卖后买**
- 先处理所有崩盘卖出信号
- 再处理所有突破买入信号
- 卖出释放的资金可用于当周买入

## 执行假设

- **交易频率**：周频，每周五收盘后评估信号
- **执行价格**：信号产生当周的收盘价
- **交易成本**：无（行业指数不可直接交易，此为模拟策略）
- **滑点**：无
- **资金利用**：允许部分资金以现金形式闲置

## 绩效指标

| 指标 | 计算方式 |
|------|----------|
| 总收益率 | (期末资产 / 期初资产) - 1 |
| 年化收益率 | (1 + 总收益率)^(1/年数) - 1 |
| 最大回撤 | 期间内从峰值到谷值的最大跌幅 |
| 夏普比率 | 周收益均值 / 周收益标准差 × √52 |
| 胜率 | 盈利交易次数 / 总配对交易次数 |

## 基准对比

- **基准**：申万行业等权指数（按所选级别的全部行业计算）
- 各行业收盘价标准化为1.0（回测起始日），取均值后缩放至初始资金规模

## 已知局限

1. **不可直接交易**：申万行业指数是统计指数，不可直接买卖。实际操作需通过行业ETF或成分股组合实现
2. **无交易成本**：未考虑手续费、印花税、滑点等摩擦成本
3. **信号滞后**：Weinstein阶段判断基于34周均线，具有较大的滞后性
4. **指数编制变化**：申万行业分类在2014年和2021年经历过调整，历史回测存在"幸存者偏差"
5. **周频限制**：策略以周为单位操作，无法捕捉日内或日间的短期波动
